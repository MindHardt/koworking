services:

  postgres:
    restart: unless-stopped
    image: postgres:18
    ports: [ "5432:5432" ]
    environment: [ "POSTGRES_PASSWORD=postgres" ]
    volumes:
      - "./.docker-volumes/postgres:/var/lib/postgresql"
      - "./postgres/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d:ro"
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
      
  keycloak:
    restart: unless-stopped
    image: quay.io/keycloak/keycloak:26.4
    ports: [ "9002:8080" ]
    command: [ "start-dev" ]
    environment:
      KC_BOOTSTRAP_ADMIN_USERNAME: admin
      KC_BOOTSTRAP_ADMIN_PASSWORD: admin
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://postgres/keycloak?user=keycloak&password=keycloak
      
  minio:
    restart: unless-stopped
    image: quay.io/minio/minio:latest
    ports: [ "9000:9000", "9001:9001" ]
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minio-user
      MINIO_ROOT_PASSWORD: minio-password
    volumes: [ "./.docker-volumes/minio:/data" ]
    healthcheck:
      test: [ "CMD", "curl", "-I", "http://localhost:9000/minio/health/live" ]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s